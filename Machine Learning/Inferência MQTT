import paho.mqtt.client as mqtt
import joblib
import json

# Carrega o modelo
model = joblib.load('modelo_alerta.pkl')

# Funcao chamada quando mensagem chega
def on_message(client, userdata, msg):
    payload = json.loads(msg.payload.decode())
    print("Recebido:", payload)

    # Extrai as variaveis
    features = [[
        payload['pot1'],
        payload['pot2'],
        payload['ax'],
        payload['ay'],
        payload['az']
    ]]

    # Fazer previsao
    prediction = model.predict(features)
    print("Alerta:", prediction[0])

# Configura o cliente MQTT
client = mqtt.Client()
client.connect("mqtt.eclipseprojects.io", 1883, 60)
client.subscribe("esp32/sensores")

client.on_message = on_message

# Loop
client.loop_forever()
